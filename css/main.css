/* main.css â€” Dark theme for Calculus of Variations Research Map */

* { margin: 0; padding: 0; box-sizing: border-box; }
html, body {
  overscroll-behavior-x: none;
  overscroll-behavior-y: none;
  overflow-x: hidden;
}
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #0a0a0f;
  color: #e0e0e0;
  overflow: hidden;
  height: 100vh;
}

/* --- App grid --- */
#app {
  --sidebar-width: 300px;
  display: grid;
  grid-template-rows: auto 1fr;
  grid-template-columns: 1fr var(--sidebar-width);
  height: 100vh;
}
#app.sidebar-wide { --sidebar-width: 460px; }
#app.sidebar-hidden { --sidebar-width: 0px; }

/* --- Header --- */
header {
  grid-column: 1 / -1;
  padding: 10px 20px;
  background: #12121a;
  border-bottom: 1px solid #2a2a3a;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 8px;
}
.header-row { display: flex; align-items: center; gap: 12px; min-height: 28px; }
.header-row-top { justify-content: flex-start; }
.header-row-bottom { justify-content: flex-start; }
header h1 { font-size: 18px; font-weight: 600; color: #fff; white-space: nowrap; }
header h1 .title-short { display: none; }
header .header-top-main {
  display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0; flex-wrap: wrap;
}
header .stats { font-size: 12px; color: #888; display: flex; gap: 15px; }
header .stats span { white-space: nowrap; }

/* Influence slider */
.inf-slider-wrap { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
.inf-slider-wrap input[type=range] {
  width: 80px; height: 4px;
  -webkit-appearance: none; appearance: none;
  background: #333; border-radius: 2px; outline: none; cursor: pointer;
}
.inf-slider-wrap input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none; appearance: none;
  width: 12px; height: 12px; border-radius: 50%; background: #667; cursor: pointer;
}
.inf-slider-wrap input[type=range]::-moz-range-thumb {
  width: 12px; height: 12px; border-radius: 50%;
  background: #667; cursor: pointer; border: none;
}
.inf-slider-wrap input[type=range]::-webkit-slider-thumb:hover { background: #88a; }

/* View controls */
.controls { display: flex; gap: 8px; flex-shrink: 0; margin-left: auto; }
.controls button {
  background: #1e1e2e; border: 1px solid #333; color: #ccc;
  padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 11px;
}
.controls button:hover { background: #2a2a3e; }
.controls button.active { background: #333366; border-color: #5555aa; color: #fff; }

/* --- Main area --- */
#main-area {
  grid-column: 1; overflow: hidden; position: relative;
  overscroll-behavior: none; min-width: 0;
}

/* --- Sidebar --- */
#sidebar {
  grid-column: 2; background: #12121a; border-left: 1px solid #2a2a3a;
  overflow-y: auto; position: relative; min-width: 0;
}
#app.sidebar-hidden #sidebar { border-left: none; overflow: hidden; }
#sidebar::-webkit-scrollbar { width: 6px; }
#sidebar::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
.sidebar-width-toggle, .sidebar-hide-toggle {
  position: fixed; top: 50%; width: 24px; height: 36px; border: 1px solid #2a2a3a;
  border-radius: 6px 0 0 6px; background: #12121a; color: #7788cc;
  font-size: 11px; cursor: pointer; z-index: 200; line-height: 1; padding: 0;
}
.sidebar-width-toggle { transform: translateY(-100%); }
.sidebar-hide-toggle { transform: translateY(4px); color: #88aacc; }
.sidebar-width-toggle:hover { background: #1a1a2e; color: #aab6ff; }
.sidebar-hide-toggle:hover { background: #1a1a2e; color: #bbd6ff; }
#sidebar .sidebar-section:first-child { padding-top: 12px; }

/* --- Views --- */
#timeline-view, #network-view, #coauthor-view {
  width: 100%; height: 100%; position: absolute; top: 0; left: 0;
}
#timeline-view { display: block; overscroll-behavior: none; }
#network-view { display: none; }
#coauthor-view { display: none; }

/* --- Timeline --- */
.timeline-container {
  width: 100%; height: 100%; overflow: hidden;
  overscroll-behavior: none; touch-action: none;
}
.timeline-container svg { touch-action: none; }

/* Pin overlay (non-interactive) */
.pin-overlay { pointer-events: none; }

/* --- Network --- */
.net-node { cursor: pointer; }
.net-link { stroke: #334; }
.net-paper-shape { stroke-width: 0.9; }
.net-label {
  fill: #bbb; font-size: 8px; pointer-events: none; font-weight: 500;
  text-anchor: middle; dominant-baseline: hanging;
  text-shadow: 0 0 3px #0a0a0f, 0 0 6px #0a0a0f;
}

/* --- Co-Author --- */
.coauthor-node { cursor: pointer; }
.coauthor-link { stroke: #445566; }
.coauthor-label {
  fill: #ccc; font-size: 11px; font-weight: 500; pointer-events: none;
  text-anchor: middle; dominant-baseline: central;
  text-shadow: 0 1px 3px #000, 0 0 6px #000;
}

/* --- Sidebar sections --- */
.sidebar-section { padding: 12px 14px; border-bottom: 1px solid #1e1e2e; }
.sidebar-section h3 {
  font-size: 12px; text-transform: uppercase; letter-spacing: 1px;
  color: #666; margin-bottom: 8px;
}

/* Thread chips */
.thread-legend { display: flex; flex-direction: column; gap: 3px; }
.thread-chip {
  font-size: 10px; padding: 2px 6px; border-radius: 3px; cursor: pointer;
  opacity: 0.7; transition: opacity 0.15s; white-space: nowrap;
  display: flex; align-items: center; gap: 6px;
}
.thread-chip:hover, .thread-chip.active { opacity: 1; }
.thread-chip .thread-label { flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; }
.thread-chip .thread-count { font-size: 9px; opacity: 0.6; flex-shrink: 0; }
.thread-chip .sparkline-wrap { flex-shrink: 0; position: relative; }
.thread-chip .sparkline-wrap svg { display: block; }

/* Author list */
.author-item { padding: 6px 0; cursor: pointer; display: flex; align-items: center; gap: 8px; }
.author-item:hover { background: #1a1a2a; }
.author-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.author-name {
  font-size: 12px; flex: 1; min-width: 0; overflow: hidden;
  text-overflow: ellipsis; white-space: nowrap;
}
.author-count {
  font-size: 10px; color: #666; flex-shrink: 0; max-width: 145px;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-align: right;
}
#app.sidebar-wide .author-count { max-width: 260px; }
.author-item.active .author-name { color: #fff; font-weight: 600; }

/* Collapsible sidebar sections */
.sidebar-collapse-hdr {
  display: flex; align-items: center; cursor: pointer;
  user-select: none; gap: 6px;
}
.sidebar-collapse-hdr h3 { margin-bottom: 0; }
.sidebar-collapse-hdr .toggle-arrow {
  font-size: 10px; color: #666; transition: transform 0.15s;
}
.sidebar-collapse-hdr .toggle-arrow.open { transform: rotate(90deg); }
.sidebar-collapse-body {
  overflow: hidden; max-height: 0; transition: max-height 0.25s ease;
}
.sidebar-collapse-body.open { max-height: 600px; }

/* --- Detail panel --- */
#detail-panel {
  display: none; position: absolute; top: 0; right: 0;
  width: 420px; max-width: 100%; height: 100%; background: #15151f;
  border-left: 1px solid #2a2a3a; overflow-y: auto; overflow-x: hidden;
  z-index: 100; padding: 16px;
  scrollbar-width: thin; scrollbar-color: #3a3a4d #15151f;
  word-break: break-word;
}
#detail-panel::-webkit-scrollbar { width: 8px; }
#detail-panel::-webkit-scrollbar-track { background: #15151f; }
#detail-panel::-webkit-scrollbar-thumb { background: #3a3a4d; border-radius: 4px; }
#detail-panel::-webkit-scrollbar-thumb:hover { background: #4a4a66; }
#detail-panel.open { display: block; }
#detail-panel .close-btn {
  position: absolute; top: 8px; right: 12px;
  background: none; border: none; color: #666; font-size: 18px; cursor: pointer;
}
#detail-panel .close-btn:hover { color: #fff; }
#detail-panel h2 {
  font-size: 16px; color: #fff; margin-bottom: 4px;
  padding-right: 30px; line-height: 1.3;
}
#detail-panel .meta { font-size: 12px; color: #888; margin-bottom: 12px; }
#detail-panel .meta a { color: #7788cc; text-decoration: none; }
#detail-panel .meta a:hover { text-decoration: underline; }

.detail-stat {
  display: flex; justify-content: space-between; padding: 4px 0;
  font-size: 12px; border-bottom: 1px solid #1a1a2a;
}
.detail-stat .label { color: #888; }
.detail-stat .value { color: #ccc; }
.detail-excerpt {
  font-size: 12px; color: #999; margin: 12px 0;
  line-height: 1.5; font-style: italic;
}

.detail-refs { margin-top: 12px; }
.detail-refs h4 { font-size: 11px; text-transform: uppercase; color: #666; margin-bottom: 6px; }
.detail-refs .ref-item { font-size: 11px; padding: 3px 0; }
.detail-refs .ref-item a { color: #7788cc; text-decoration: none; cursor: pointer; }
.detail-refs .ref-item a:hover { text-decoration: underline; }

/* Paper items */
.paper-item { padding: 6px 0; border-bottom: 1px solid #1a1a2a; }
.paper-item:last-child { border-bottom: none; }
.paper-title { color: #9cc8ff; text-decoration: none; font-size: 11px; line-height: 1.35; }
.paper-title:hover { text-decoration: underline; }
.paper-meta { color: #7f7f95; font-size: 10px; margin-top: 2px; }

/* Paper filters */
.paper-filter-grid { display: flex; flex-direction: column; gap: 6px; margin-bottom: 8px; }
.paper-filter-row { display: flex; align-items: center; gap: 6px; }
.paper-filter-row .pf-label {
  width: 74px; flex-shrink: 0; font-size: 10px; color: #8b8ba3;
  text-transform: uppercase; letter-spacing: 0.4px;
}
.paper-filter-row .pf-sep { color: #666; font-size: 10px; }
.pf-input, .pf-select {
  background: #1a1a2e; border: 1px solid #333; color: #bbb;
  border-radius: 4px; font-size: 10px; padding: 2px 6px; min-width: 0;
}
.pf-input { width: 62px; }
.pf-select { flex: 1; }
.pf-range { flex: 1; min-width: 0; accent-color: #6c8fb6; }
.pf-value { width: 36px; text-align: right; color: #8a8aa0; font-size: 10px; }
.pf-reset-btn {
  margin-left: auto; background: #1a1a2a; border: 1px solid #334; color: #88aadd;
  border-radius: 4px; padding: 2px 7px; font-size: 10px; cursor: pointer;
}
.pf-reset-btn:hover { border-color: #446a99; color: #aaccff; }
.paper-sidebar-summary { color: #6f6f86; font-size: 10px; margin: 4px 0 6px; }
.paper-sidebar-list { max-height: 300px; overflow-y: auto; border-top: 1px solid #1a1a2a; }
.paper-sidebar-list::-webkit-scrollbar { width: 6px; }
.paper-sidebar-list::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
.paper-sidebar-item { padding: 7px 0; border-bottom: 1px solid #1a1a2a; cursor: pointer; }
.paper-sidebar-item:last-child { border-bottom: none; }
.paper-sidebar-item:hover .paper-title { text-decoration: underline; }

/* Tag chips */
.tag-chip {
  display: inline-block; font-size: 10px; padding: 1px 5px;
  background: #1e2a3a; border: 1px solid #2a3a5a; border-radius: 3px;
  margin: 1px; color: #88aacc; cursor: pointer;
}
.tag-chips { display: flex; flex-wrap: wrap; gap: 2px; }
.tag-chip:hover { border-color: #4a6a9a; }
.tag-chip.active { background: #2a3f5a; border-color: #5599cc; color: #99ccff; }
.chip-count { font-size: 9px; color: #667; margin-left: 2px; }

/* Thread bar (author detail) */
.thread-bar-row { display: flex; align-items: center; gap: 6px; padding: 3px 0; font-size: 11px; }
.thread-bar-label {
  color: #888; width: 110px; overflow: hidden; text-overflow: ellipsis;
  white-space: nowrap; flex-shrink: 0;
}
.thread-bar-track { flex: 1; height: 6px; background: #1a1a2a; border-radius: 3px; overflow: hidden; }
.thread-bar-fill { height: 100%; border-radius: 3px; }
.thread-bar-pct { color: #666; font-size: 10px; width: 32px; text-align: right; flex-shrink: 0; }

/* Thread detail stats */
.thread-stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin: 10px 0; }
.thread-stat-box { background: #1a1a2a; border-radius: 4px; padding: 6px 8px; text-align: center; }
.thread-stat-box .tsb-val { font-size: 16px; font-weight: 600; color: #fff; }
.thread-stat-box .tsb-lbl {
  font-size: 9px; color: #666; text-transform: uppercase; letter-spacing: 0.5px;
}

/* --- Search --- */
#search-box {
  width: 100%; padding: 6px 8px; background: #1a1a2a;
  border: 1px solid #333; border-radius: 4px; color: #ccc; font-size: 12px;
}
#search-box:focus { outline: none; border-color: #555; }
.search-wrap { position: relative; margin-bottom: 8px; }
.header-search-wrap { margin-left: auto; margin-bottom: 0; width: min(420px, 46vw); flex-shrink: 0; }
.search-dropdown {
  position: absolute; top: 100%; left: 0; right: 0; background: #1a1a2e;
  border: 1px solid #444; border-top: none; border-radius: 0 0 4px 4px;
  max-height: 280px; overflow-y: auto; z-index: 200; display: none;
}
.search-dropdown::-webkit-scrollbar { width: 5px; }
.search-dropdown::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
.search-item {
  padding: 6px 10px; cursor: pointer; font-size: 11px;
  border-bottom: 1px solid #1e1e2e;
}
.search-item:hover, .search-item.active { background: #252540; }
.search-item .si-title {
  color: #ccc; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.search-item .si-meta { color: #666; font-size: 10px; margin-top: 1px; }
.search-item .si-thread {
  display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 4px;
}
.search-item-paper { border-left: 2px solid #8fb8ef; }

/* --- Filter breadcrumb --- */
.breadcrumb {
  font-size: 11px; color: #888; display: flex; align-items: center;
  gap: 6px; flex: 1; min-width: 0;
}
.breadcrumb:empty { display: none; }
.bc-tag {
  display: inline-flex; align-items: center; gap: 4px;
  background: #1e1e2e; border: 1px solid #333;
  border-radius: 3px; padding: 2px 8px; color: #bbb; white-space: nowrap;
}
.bc-tag .bc-close { cursor: pointer; color: #666; margin-left: 2px; }
.bc-tag .bc-close:hover { color: #fff; }

/* --- Help overlay --- */
.help-overlay {
  display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.7); z-index: 1000;
  justify-content: center; align-items: center;
}
.help-overlay.open { display: flex; }
.help-card {
  background: #1a1a2a; border: 1px solid #333; border-radius: 8px;
  padding: 24px; max-width: 480px; width: 90%;
}
.help-card h3 { color: #fff; font-size: 15px; margin-bottom: 16px; }
.help-grid { display: grid; grid-template-columns: auto 1fr; gap: 6px 16px; }
.help-key { font-size: 11px; color: #88aaff; font-weight: 600; white-space: nowrap; }
.help-desc { font-size: 11px; color: #bbb; }
.help-btn {
  background: none !important; border: 1px solid #444 !important;
  width: 24px; height: 24px; font-size: 13px !important; font-weight: 700;
  border-radius: 50% !important; padding: 0 !important;
  display: flex; align-items: center; justify-content: center;
}

/* --- Toast --- */
.toast {
  position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
  background: #2a3a2a; border: 1px solid #4a6a4a; color: #88cc88;
  padding: 8px 16px; border-radius: 4px; font-size: 12px; z-index: 1000;
  opacity: 0; transition: opacity 0.3s; pointer-events: none;
}
.toast.show { opacity: 1; }

/* --- Tooltip --- */
.tooltip {
  position: fixed; background: #1e1e2e; border: 1px solid #444;
  border-radius: 4px; padding: 8px 12px; font-size: 11px; color: #ccc;
  pointer-events: none; z-index: 500; max-width: 350px;
  line-height: 1.4; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}

/* --- Content toggle buttons --- */
.content-toggles { display: flex; gap: 4px; flex-shrink: 0; }
.content-toggle {
  background: #1e1e2e; border: 1px solid #333; color: #888;
  padding: 2px 8px; border-radius: 3px; cursor: pointer; font-size: 10px;
}
.content-toggle:hover { background: #2a2a3e; }
.content-toggle.active { background: #2a3a2a; border-color: #4a6a4a; color: #88cc88; }
.content-toggle.papers-toggle.active { background: #1f2f45; border-color: #4b6f9d; color: #9cc8ff; }


/* --- Responsive --- */
@media (max-width: 1450px) {
  header { padding: 10px 12px; gap: 8px; }
  header h1 .title-long { display: none; }
  header h1 .title-short { display: inline; }
  .header-row-top { gap: 8px; }
  .header-row-bottom { gap: 8px; min-height: 24px; }
  .header-search-wrap { width: min(340px, 45vw); }
  .content-toggles { flex-wrap: wrap; }
}

@media (max-width: 1240px) {
  .controls button { padding: 4px 8px; font-size: 10px; }
  .header-search-wrap { width: min(300px, 42vw); }
}
